name: Cloudflare Pages Deploy

on:
  workflow_dispatch:  # 仅支持手动触发重新部署
    inputs:
      account:
        description: '要部署的账户（留空部署所有）'
        required: false
        default: 'all'

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - account: 'account_1'
            api_token_secret: 'TXDn4V-iYDFDz7iso02xmH2qP12VqAIexPrh2539'  # Secrets 中的名称
            account_id_secret: '79927cfd3333c7b3e2363958a2d58158'
            project_name: 'zipv-7700foxm'
          # 添加新账户示例：
          # - account: 'account_2'
          #   api_token_secret: 'ACCOUNT_2_API_TOKEN'
          #   account_id_secret: 'ACCOUNT_2_ACCOUNT_ID'
          #   project_name: 'another-project'
    if: ${{ github.event.inputs.account == 'all' || github.event.inputs.account == matrix.account }}
    permissions:
      contents: read  # 仅需读取仓库权限
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # 如需构建静态文件（例如 Vite、Hugo、Next.js 等），请在此取消注释并调整命令
      # - run: npm install && npm run build
      # - run: yarn install && yarn build

      - name: Deploy to Cloudflare Pages
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets[matrix.api_token_secret] }}
          accountId: ${{ secrets[matrix.account_id_secret] }}
          command: pages deploy . --project-name=${{ matrix.project_name }}
          # . 表示当前目录为构建输出目录
          # 若您的静态文件输出在 dist、build 等子目录，请改为：pages deploy dist --project-name=...

      # 可选：输出部署 URL，便于在 Actions 日志中快速查看
      - name: Print deployment URL
        if: success()
        run: |
          echo "部署成功！预览地址：https://${{ matrix.project_name }}.pages.dev"
